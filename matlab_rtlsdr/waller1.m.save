function waller1

page_screen_output(0);
page_output_immediately(1);

f0 = 60500000;
rate = 2400000;

soc = rtl_sdr_connect;
soc = rtl_sdr_setFreq(soc,f0); % set initial frequency
soc = rtl_sdr_setRate(soc,rate); % set sampling rate

soc = rtl_sdr_setFreqCorr(soc,0); % set frequency correction to 0

% Resetting the connection may cause undesirable behavior
% when RTL_TCP runs on an ARM chip
%soc = rtl_sdr_reset(soc);

%%%%%%%%% open figure and create sliders- %%%%%%%%%%%%%%%%%%%%%%%%%%%
%figure(1)
%        h_fine = uicontrol('Style', 'slider',...
%        'Min',-200,'Max',200,'Value',0,...
%        'Position', [20 120 400 20],'Callback', @setCorr); drawnow
%        
%        h_finet = uicontrol('Style', 'text',...
%        'Position', [200 90 100 12],'String',sprintf('fine tune: %d',0)); drawnow
%         
%        h_freqt = uicontrol('Style', 'text',...
%        'Position', [200 30 100 12],'String','96'); drawnow
%        
%        h_freq = uicontrol('Style', 'slider',...
%        'Min',0,'Max',1999,'Value',f0/1e6,'SliderStep',[0.0005,0.0005], ...
%        'Position', [20 60 400 20],'Callback', @setFreq); drawnow
%            
%set(h_fine,'UserData',{soc,h_finet})
%set(h_freq,'UserData',{soc,h_freqt})
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


while(1)

%y = rtl_sdr_getData(soc, rate); % acuire one capture
printf("\n\n")
y = rtl_sdr_getData(soc, 2e6); % acuire one capture

%%%x = reshape(y,2500,800);  % reshape to sequences of length 2500

printf("Going to FFTshift now\n");
X = fftshift(fft(y,[],1),1); % compute the spectrum

printf("Going to computer average power spectrum now\n");
pSpect = mean(abs(X).^2,2); % compute average power spectrum

%freq = f0; % get center frequency from GUI

% plot log power spectrum
printf("Now: subplot -- this will probably lock the window\n");
subplot(2,1,1), semilogy(linspace(-1.2,1.2,2500)+f0,pSpect);

printf("Now: axis\n");
axis([-1.2+f0,1.2+f0,1e6,1e10]);

% modify figure to look nice with many ticks
h = gca;
set(h,'XTick',linspace(f0-1,f0+1,21));

printf("Now: drawnow\n");
drawnow ; % force matlab to display update

printf("End of loop, cycling\n");
end


%function setCorr(hObj, event, ax)
% set frequency correction from GUI
%    data = get(hObj,'UserData');
%    val = floor(get(hObj,'Value'));
%    set(data{2},'String',sprintf('fine tune: %d',num2str(val)));
%    rtl_sdr_setFreqCorr(data{1},val);

%function setFreq(hObj, event, ax)
%  set new center frequency from GUI
%    data = get(hObj,'UserData');
%    val = floor(get(hObj,'Value'));
%    set(data{2},'String',num2str(val*1));
%    rtl_sdr_setFreq(data{1},floor((val)*1*1e6));
    

    

